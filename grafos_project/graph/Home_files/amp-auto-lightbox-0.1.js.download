;
(self.AMP=self.AMP||[]).push({m:0,v:"2203172113000",n:"amp-auto-lightbox",ev:"0.1",l:!0,f:function(n,r){!function(){var r="load-end";function t(n){return n?Array.prototype.slice.call(n):[]}Array.isArray;var u=Object.prototype;function o(n,r,t,u,o,e,i,a,f,c,l){return n}function e(n){return(n.ownerDocument||n).defaultView}function i(n,r){return n.closest?n.closest(r):function(n,r,t){var u;for(u=n;u&&void 0!==u;u=u.parentElement)if(r(u))return u;return null}(n,(function(n){return function(n,r){var t=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector;return!!t&&t.call(n,r)}(n,r)}))}u.hasOwnProperty,u.toString;var a,f=!0,c=!0;function l(n){return n.parent&&n.parent!=n}var v,s,p=function(){var n=this;this.promise=new Promise((function(r,t){n.resolve=r,n.reject=t}))};new WeakMap,new WeakMap;var m=self.AMP_CONFIG||{},d=("string"==typeof m.thirdPartyFrameRegex?new RegExp(m.thirdPartyFrameRegex):m.thirdPartyFrameRegex,("string"==typeof m.cdnProxyRegex?new RegExp(m.cdnProxyRegex):m.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function g(n){if(!self.document||!self.document.head)return null;if(self.location&&d.test(self.location.origin))return null;var r=self.document.head.querySelector('meta[name="'.concat(n,'"]'));return r&&r.getAttribute("content")||null}m.thirdPartyUrl,m.thirdPartyFrameHost,m.cdnUrl||g("runtime-host"),m.errorReportingUrl,m.betaErrorReportingUrl,m.localDev,m.geoApiUrl||g("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var h=self.__AMP_LOG;function w(n,r){throw new Error("failed to call initLogConstructor")}function y(n){return w()}function b(){return h.dev||(h.dev=w())}function P(n,r,t,u,o,e,i,a,f,c,l){return n}function x(n,r){return I(n=function(n){return n.__AMP_TOP||(n.__AMP_TOP=n)}(n),r)}function M(n,r){return I(E(A(n)),r)}function A(n){return n.nodeType?(r=e(n),x(r,"ampdoc")).getAmpDoc(n):n;var r}function E(n){var r=A(n);return r.isSingleDoc()?r.win:r}function I(n,r){P(D(n,r));var t=function(n){var r=n.__AMP_SERVICES;return r||(r=n.__AMP_SERVICES={}),r}(n)[r];return t.obj||(P(t.ctor),P(t.context),t.obj=new t.ctor(t.context),P(t.obj),t.context=null,t.resolve&&t.resolve(t.obj)),t.obj}function D(n,r){var t=n.__AMP_SERVICES&&n.__AMP_SERVICES[r];return!(!t||!t.ctor)}var O,W=function(n){return M(n,"mutator")};function k(n,r,t,u){var o=t,e=function(n,r,t,u){var o=n,e=t,i=function(n){try{return e(n)}catch(n){var r,t;throw null===(r=(t=self).__AMP_REPORT_ERROR)||void 0===r||r.call(t,n),n}},a=function(){if(void 0!==O)return O;O=!1;try{var n={get capture(){return O=!0,!1}};self.addEventListener("test-options",null,n),self.removeEventListener("test-options",null,n)}catch(n){}return O}(),f=!(null==u||!u.capture);return o.addEventListener(r,i,a?u:f),function(){null==o||o.removeEventListener(r,i,a?u:f),e=null,o=null,i=null}}(n,r,(function(n){try{o(n)}finally{o=null,e()}}),u);return e}function B(n){return"AUDIO"===n.tagName||"VIDEO"===n.tagName}/nochunking=1/.test(self.location.hash),a||(a=Promise.resolve(void 0));var S="amp-auto-lightbox",G="amp-lightbox-gallery",R="lightbox",j="i-amphtml-auto-lightbox-visited",C={"Article":!0,"NewsArticle":!0,"BlogPosting":!0,"LiveBlogPosting":!0,"DiscussionForumPosting":!0},F=["[placeholder]","[data-amp-auto-lightbox-disable]","amp-selector [option]","[subscriptions-action]"].join(","),N=["a[href]","amp-script","amp-story","button","amp-lightbox","amp-carousel"].join(","),H=function(){},L=function(){function n(){}return n.meetsAll=function(r,t,u,o){return n.meetsSizingCriteria(r,t,u,o)&&n.meetsTreeShapeCriteria(r,t)},n.meetsTreeShapeCriteria=function(n,r){return!("IMG"===n.tagName&&i(n,"amp-img")||i(n,"".concat(N,",").concat(F))||function(n){return r="action",D(t=E(A(n)),r)?I(t,r):null;var r,t}(r||n).hasResolvableAction(n,"tap"))},n.meetsSizingCriteria=function(n,r,t,u){var o,e=function(n){var r=n.naturalHeight,t=n.naturalWidth,u=t/r,o=function(n){var r,t=-1,u=n.getAttribute("srcset");if(u)for(;r=T.exec(u);){var o=parseInt(r[1],10);o>t&&(t=o)}return t}(n);return o>t?{naturalWidth:o,naturalHeight:o/u}:{naturalWidth:t,naturalHeight:r}}(n.querySelector("img")||n),i=e.naturalHeight,a=e.naturalWidth,f=(o=r,M(o,"viewport")).getSize(),c=f.height;return function(n,r,t,u,o,e){var i=n*r;return t*u/i>=1.2||t>o||u>e||i/(o*e)>=.25}(t,u,a,i,f.width,c)},n}(),T=/\s+([0-9]+)w(,|[\S\s]*$)/g;function U(n){return W(n).mutateElement(n,(function(){n.setAttribute(j,"")}))}var Y=function(){function n(){}return n.getCandidates=function(n){var r=["amp-img","img"].map((function(n){return"".concat(n,":not([").concat(R,"]):not([").concat(j,"])")})).join(","),u=t(n.querySelectorAll(r));return u.forEach(U),u},n}(),$=function(){function n(){}return n.getOgType=function(n){var r=n.getRootNode().querySelector('meta[property="og:type"]');if(r)return r.getAttribute("content")},n.hasValidOgType=function(r){return"article"==n.getOgType(r)},n.getAllLdJsonTypes=function(n){return t(n.getRootNode().querySelectorAll('script[type="application/ld+json"]')).map((function(n){return(function(n,r){try{return function(n){return JSON.parse(n)}(n)}catch(n){return null}}(n.textContent)||{})["@type"]})).filter(Boolean)},n.hasValidLdJsonType=function(r){return n.getAllLdJsonTypes(r).some((function(n){return C[n]}))},n}(),z=0;function J(n,t){return t.map((function(t){return(u=t,"IMG"===u.tagName?function(n){var r,t;if(function(n){return!!(n.complete||"complete"==n.readyState||B(n)&&n.readyState>0||n.document&&"complete"==n.document.readyState)}(n))return Promise.resolve(n);var u=B(n);return u&&n.__AMP_MEDIA_LOAD_FAILURE_SRC===n.currentSrc?Promise.reject(n):new Promise((function(o,e){if(r=u?k(n,"loadedmetadata",o,{capture:!0}):k(n,"load",o),n.tagName){var i=n;if(u&&!n.hasAttribute("src")&&!(i=function(n,r){for(var t=n.lastElementChild;t;t=t.previousElementSibling)if(r(t))return t;return null}(n,(function(n){return"SOURCE"===n.tagName}))))return e(new Error("Media has no source."));t=k(i,"error",e)}})).then((function(){return t&&t(),n}),(function(){r&&r(),function(n){B(n)&&(n.__AMP_MEDIA_LOAD_FAILURE_SRC=n.currentSrc||!0);var r=n;throw r&&r.src&&(r=r.src),(h.user||(h.user=y()),void h.user.win?h.userForEmbed||(h.userForEmbed=y()):h.user).createError("Failed to load:",r)}(n)}))}(u):function(n){if(o(function(n){var r=n.tagName;return r.startsWith("AMP-")&&!("AMP-STICKY-AD-TOP-PADDING"==r||"AMP-BODY"==r)}(n)),n.createdCallback)return Promise.resolve(n);if(!n.__AMP_UPG_PRM){var r=new p;n.__AMP_UPG_PRM=r.promise,n.__AMP_UPG_RES=r.resolve}var t=n.__AMP_UPG_PRM;return o(t),t}(u).then((function(n){return n.signals().whenSignal(r)}))).then((function(){return function(n){var r,t=null===(r=v)||void 0===r?void 0:r.get(n);if(!t){var u=function(n){v||(v=new WeakMap,s=new WeakMap),o(s);var r=s.get(n);return r||(r=function(n,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=t.needsRootBounds,o=t.rootMargin,e=t.threshold,i=l(r)&&(u||o)?r.document:void 0;return new r.IntersectionObserver(n,{threshold:e,root:i,rootMargin:o})}((function(n){for(var t=new Set,u=n.length-1;u>=0;u--){var e,i=n[u].target;t.has(i)||(t.add(i),o(r),r.unobserve(i),o(v),null===(e=v.get(i))||void 0===e||e.resolve(n[u]),v.delete(i))}}),n,{needsRootBounds:!1}),s.set(n,r)),r}(e(n));o(v),u.observe(n),t=new p,v.set(n,t)}return t.promise}(t).then((function(u){var e=u.boundingClientRect;if("IMG"===t.tagName||t.signals().get(r)){var i=e.height,a=e.width;if(L.meetsAll(t,n,a,i))return b().info(S,"apply",t),function(n,r){return W(n).mutateElement(r,(function(){r.setAttribute(R,"i-amphtml-auto-lightbox-".concat(z++))})).then((function(){return(t=n.win,x(t,"extensions")).installExtensionForDoc(n,G),function(n,r,t,u){o(n.ownerDocument);var e=n.ownerDocument.createEvent("Event");e.data={};var i=f,a=c;e.initEvent("amp-auto-lightbox:newly-set",i,a),n.dispatchEvent(e)}(r),r;var t}))}(n,t)}}))}),H);var u}))}function K(n,r){if(function(n){return!function(n){var r='script[custom-element="'.concat(G,'"]'),t="[".concat(R,"]:not([").concat(j,"])"),u=function(r){return!!n.getRootNode().querySelector(r)};return u(r)&&u(t)}(n)&&($.hasValidOgType(n)||$.hasValidLdJsonType(n))}(n)){var t=r||n.win.document;return J(n,Y.getCandidates(t))}b().info(S,"disabled")}var V=n.ampdoc;V.whenReady().then((function(){V.getRootNode().addEventListener("amp:dom-update",(function(n){var r=n.target;K(V,r)})),K(V)}))}();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-auto-lightbox-0.1.js.map